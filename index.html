<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>KPI (XML)</title>
  <meta http-equiv="Cache-Control" content="no-store" />
  <style>
    body { font-family: Arial, sans-serif; text-align:center; margin:40px 12px; }
    #data { margin-top: 16px; padding: 12px; border: 1px solid #ddd; display:inline-block; max-width: 95vw; text-align:left; white-space: pre-wrap; }
    .err { color: #b00020; }
  </style>
</head>
<body>
  <h1>Pres KPI</h1>
  <div id="data">Veri yükleniyor…</div>

  <script>
    const XML_URL = "http://192.168.42.34:2700/drk15/BIOnlineKPI/11";
    const USER = "admin";
    const PASS = "salla";

    async function getXML() {
      try {
        const auth = 'Basic ' + btoa(`${USER}:${PASS}`);
        const res = await fetch(XML_URL + `?t=${Date.now()}`, {
          method: 'GET',
          headers: { 'Authorization': auth },
          cache: 'no-store',
        });

        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        const text = await res.text();
        const xml = new DOMParser().parseFromString(text, 'application/xml');

        // Örnek: tag isimlerini bilmediğimiz için önce başlığı yazalım, sonra ham XML’i gösterelim
        // İstersen belirli tag’ları söyle, onları seçip tablo yapalım.
        const maybeErr = xml.getElementsByTagName('parsererror')[0];
        if (maybeErr) throw new Error('Geçersiz XML veya CORS bloklandı');

        // Burayı kendi XML şemanına göre özelleştirebiliriz:
        // const val = xml.getElementsByTagName('SomeTag')[0]?.textContent ?? '';

        document.getElementById('data').textContent = text; // şimdilik ham XML gösteriyoruz
      } catch (e) {
        document.getElementById('data').innerHTML = `<span class="err">XML okunamadı: ${e}</span>`;
        console.error(e);
      }
    }

    getXML();
    setInterval(getXML, 5000);
  </script>
</body>
</html>
